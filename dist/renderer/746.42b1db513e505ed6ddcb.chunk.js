"use strict";(global.webpackChunkg_asset_forge=global.webpackChunkg_asset_forge||[]).push([[746],{5746:(t,e,i)=>{i.d(e,{SuikaCanvasEngine:()=>u});class o{constructor(){this.listeners=new Map}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){const i=this.listeners.get(t);i&&(i.delete(e),0===i.size&&this.listeners.delete(t))}emit(t,...e){const i=this.listeners.get(t);i&&i.forEach(i=>{try{i(...e)}catch(e){console.error(`Error in event listener for ${String(t)}:`,e)}})}removeAllListeners(t){t?this.listeners.delete(t):this.listeners.clear()}}class r{constructor(t){this.viewport={x:0,y:0,width:0,height:0},this.editor=t}setViewport(t){this.viewport={...t},this.updateCanvasSize()}getViewport(){return{...this.viewport}}updateCanvasSize(){const t=this.editor.canvasElement,e=window.devicePixelRatio||1;t.width=this.viewport.width*e,t.height=this.viewport.height*e,t.style.width=`${this.viewport.width}px`,t.style.height=`${this.viewport.height}px`,this.editor.ctx.scale(e,e)}pan(t,e){this.viewport.x+=t,this.viewport.y+=e,this.editor.render()}centerView(){this.viewport.x=-this.viewport.width/2,this.viewport.y=-this.viewport.height/2,this.editor.render()}}class s{constructor(t){this.zoom=1,this.minZoom=.1,this.maxZoom=10,this.editor=t}getZoom(){return this.zoom}setZoom(t,e,i){const o=Math.max(this.minZoom,Math.min(this.maxZoom,t));if(o===this.zoom)return;const r=this.zoom;if(this.zoom=o,void 0!==e&&void 0!==i){const t=this.editor.viewportManager.getViewport(),s=o/r,n=e-(e-t.x)*s,h=i-(i-t.y)*s;this.editor.viewportManager.setViewport({...t,x:n,y:h})}this.editor.render()}zoomIn(t,e){this.setZoom(1.2*this.zoom,t,e)}zoomOut(t,e){this.setZoom(this.zoom/1.2,t,e)}zoomToFit(t=50){const e=this.editor.viewportManager.getViewport(),i=this.getCanvasBounds();if(!i)return this.setZoom(1),void this.editor.viewportManager.centerView();const o=(e.width-2*t)/i.width,r=(e.height-2*t)/i.height,s=Math.min(o,r,1);this.setZoom(s);const n=i.x+i.width/2,h=i.y+i.height/2;this.editor.viewportManager.setViewport({...e,x:e.width/2-n*s,y:e.height/2-h*s})}getCanvasBounds(){return{x:0,y:0,width:800,height:600}}resetZoom(){this.setZoom(1),this.editor.viewportManager.centerView()}}class n{constructor(t){this.objects=new Map,this.rootObjects=[],this.editor=t}addObject(t,e){this.objects.set(t.id,t),e?(e.children||(e.children=[]),e.children.push(t)):this.rootObjects.push(t),this.editor.render()}removeObject(t){const e=this.objects.get(t);e&&(this.rootObjects=this.rootObjects.filter(e=>e.id!==t),this.objects.forEach(e=>{e.children&&(e.children=e.children.filter(e=>e.id!==t))}),e.children&&e.children.forEach(t=>this.removeObject(t.id)),this.objects.delete(t),this.editor.render())}getObject(t){return this.objects.get(t)}getAllObjects(){return Array.from(this.objects.values())}getRootObjects(){return[...this.rootObjects]}clear(){this.objects.clear(),this.rootObjects=[],this.editor.render()}render(){const t=this.editor.ctx,e=this.editor.viewportManager.getViewport(),i=this.editor.zoomManager.getZoom();t.clearRect(0,0,e.width,e.height),t.save(),t.scale(i,i),t.translate(-e.x/i,-e.y/i),this.rootObjects.forEach(e=>this.renderObject(t,e)),t.restore()}renderObject(t,e){if(e.visible){switch(t.save(),t.translate(e.x,e.y),e.type){case"rectangle":default:this.renderRectangle(t,e);break;case"circle":this.renderCircle(t,e);break;case"text":this.renderText(t,e)}e.children&&e.children.forEach(e=>this.renderObject(t,e)),t.restore()}}renderRectangle(t,e){t.fillStyle="#cccccc",t.strokeStyle="#666666",t.lineWidth=1,t.fillRect(0,0,e.width,e.height),t.strokeRect(0,0,e.width,e.height)}renderCircle(t,e){const i=Math.min(e.width,e.height)/2,o=e.width/2,r=e.height/2;t.fillStyle="#cccccc",t.strokeStyle="#666666",t.lineWidth=1,t.beginPath(),t.arc(o,r,i,0,2*Math.PI),t.fill(),t.stroke()}renderText(t,e){t.fillStyle="#333333",t.font="16px Arial",t.textAlign="left",t.textBaseline="top";const i=e.text||"Text";t.fillText(i,0,0)}}var h;!function(t){t.SELECT="select",t.RECTANGLE="rectangle",t.CIRCLE="circle",t.TEXT="text",t.PAN="pan"}(h||(h={}));class c{constructor(t){this.currentTool=null,this.tools=new Map,this.editor=t,this.initializeTools(),this.bindEvents()}initializeTools(){this.tools.set(h.SELECT,{type:h.SELECT,onMouseDown:t=>{console.log("Select tool mouse down")},onMouseMove:t=>{},onMouseUp:t=>{console.log("Select tool mouse up")}}),this.tools.set(h.RECTANGLE,{type:h.RECTANGLE,onMouseDown:t=>{const e=this.editor.getSceneCursorXY(t);console.log("Rectangle tool mouse down at",e)},onMouseMove:t=>{},onMouseUp:t=>{console.log("Rectangle tool mouse up")}}),this.tools.set(h.CIRCLE,{type:h.CIRCLE,onMouseDown:t=>{const e=this.editor.getSceneCursorXY(t);console.log("Circle tool mouse down at",e)}}),this.tools.set(h.TEXT,{type:h.TEXT,onMouseDown:t=>{const e=this.editor.getSceneCursorXY(t);console.log("Text tool mouse down at",e)}}),this.tools.set(h.PAN,{type:h.PAN,onMouseDown:t=>{console.log("Pan tool mouse down")},onMouseMove:t=>{}}),this.setActiveTool(h.SELECT)}bindEvents(){const t=this.editor.canvasElement;t.addEventListener("mousedown",this.handleMouseDown.bind(this)),t.addEventListener("mousemove",this.handleMouseMove.bind(this)),t.addEventListener("mouseup",this.handleMouseUp.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("keyup",this.handleKeyUp.bind(this))}handleMouseDown(t){this.currentTool?.onMouseDown&&this.currentTool.onMouseDown(t)}handleMouseMove(t){this.currentTool?.onMouseMove&&this.currentTool.onMouseMove(t)}handleMouseUp(t){this.currentTool?.onMouseUp&&this.currentTool.onMouseUp(t)}handleKeyDown(t){this.currentTool?.onKeyDown&&this.currentTool.onKeyDown(t)}handleKeyUp(t){this.currentTool?.onKeyUp&&this.currentTool.onKeyUp(t)}setActiveTool(t){this.currentTool?.deactivate&&this.currentTool.deactivate();const e=this.tools.get(t);e&&(this.currentTool=e,e.activate&&e.activate())}getActiveTool(){return this.currentTool}getActiveToolType(){return this.currentTool?.type||null}}class a{constructor(t){this.history=[],this.currentIndex=-1,this.maxHistorySize=100,this.editor=t}execute(t){t.execute(),this.history=this.history.slice(0,this.currentIndex+1);const e=this.history[this.currentIndex];if(e&&e.canMerge&&e.canMerge(t)){const i=e.merge(t);this.history[this.currentIndex]=i}else this.history.push(t),this.currentIndex++,this.history.length>this.maxHistorySize&&(this.history.shift(),this.currentIndex--);this.editor.render()}undo(){return!!this.canUndo()&&(this.history[this.currentIndex].undo(),this.currentIndex--,this.editor.render(),!0)}redo(){return!!this.canRedo()&&(this.currentIndex++,this.history[this.currentIndex].execute(),this.editor.render(),!0)}canUndo(){return this.currentIndex>=0}canRedo(){return this.currentIndex<this.history.length-1}clear(){this.history=[],this.currentIndex=-1}getHistorySize(){return this.history.length}getCurrentIndex(){return this.currentIndex}}class d{constructor(t){this.emitter=new o,this.options=t,this.containerElement=t.containerElement,this.paperId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}),this.canvasElement=document.createElement("canvas"),this.containerElement.appendChild(this.canvasElement),this.ctx=this.canvasElement.getContext("2d"),this.viewportManager=new r(this),this.zoomManager=new s(this),this.sceneGraph=new n(this),this.toolManager=new c(this),this.commandManager=new a(this),this.viewportManager.setViewport({x:-t.width/2,y:-t.height/2,width:t.width,height:t.height}),Promise.resolve().then(()=>{this.render()})}toScenePt(t,e){const i=this.zoomManager.getZoom(),o=this.viewportManager.getViewport();return{x:(t-o.x)/i,y:(e-o.y)/i}}toViewportPt(t,e){const i=this.zoomManager.getZoom(),o=this.viewportManager.getViewport();return{x:t*i+o.x,y:e*i+o.y}}getCursorXY(t){const e=this.canvasElement.getBoundingClientRect();return{x:t.clientX-e.left-(this.options.offsetX||0),y:t.clientY-e.top-(this.options.offsetY||0)}}getSceneCursorXY(t){const{x:e,y:i}=this.getCursorXY(t);return this.toScenePt(e,i)}render(){this.sceneGraph.render(),this.emitter.emit("render")}destroy(){this.canvasElement&&this.containerElement.contains(this.canvasElement)&&this.containerElement.removeChild(this.canvasElement),this.emitter.emit("destroy")}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}}var l=i(2675);class u{constructor(){this.type=l.L.SUIKA,this.editor=null,this.container=null}async initialize(t,e){this.container=t,this.editor=new d({containerElement:t,width:e.size.width,height:e.size.height,showPerfMonitor:!1}),await new Promise(t=>setTimeout(t,100))}destroy(){this.editor&&(this.editor.destroy(),this.editor=null),this.container=null}getState(){if(!this.editor)throw new Error("Suika editor not initialized");const t=this.editor.zoomManager.getZoom(),e=this.editor.viewportManager.getViewport();return{layers:[],selectedObjects:[],activeLayer:"default",zoom:t,pan:{x:e.x,y:e.y}}}setState(t){if(!this.editor)throw new Error("Suika editor not initialized");if(void 0!==t.zoom&&this.editor.zoomManager.setZoom(t.zoom),void 0!==t.pan){const e=this.editor.viewportManager.getViewport();this.editor.viewportManager.setViewport({...e,x:t.pan.x,y:t.pan.y})}}addObject(t){if(!this.editor)throw new Error("Suika editor not initialized");console.log("Adding object to Suika:",t)}removeObject(t){if(!this.editor)throw new Error("Suika editor not initialized");console.log("Removing object from Suika:",t)}updateObject(t,e){if(!this.editor)throw new Error("Suika editor not initialized");console.log("Updating object in Suika:",t,e)}selectObjects(t){if(!this.editor)throw new Error("Suika editor not initialized");console.log("Selecting objects in Suika:",t)}clearSelection(){if(!this.editor)throw new Error("Suika editor not initialized");console.log("Clearing selection in Suika")}zoom(t){if(!this.editor)throw new Error("Suika editor not initialized");this.editor.zoomManager.setZoom(t)}pan(t,e){if(!this.editor)throw new Error("Suika editor not initialized");this.editor.viewportManager.pan(t,e)}render(){if(!this.editor)throw new Error("Suika editor not initialized");this.editor.render()}exportImage(t,e=1){if(!this.editor)throw new Error("Suika editor not initialized");return this.editor.canvasElement.toDataURL(`image/${t}`,e)}getSuikaEditor(){return this.editor}}}}]);