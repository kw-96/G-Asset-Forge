"use strict";(global.webpackChunkg_asset_forge=global.webpackChunkg_asset_forge||[]).push([[553],{6553:(t,e,i)=>{i.d(e,{H5EditorCanvasEngine:()=>s});class n{constructor(){this.listeners=new Map}on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){const i=this.listeners.get(t);i&&(i.delete(e),0===i.size&&this.listeners.delete(t))}emit(t,...e){const i=this.listeners.get(t);i&&i.forEach(i=>{try{i(...e)}catch(e){console.error(`Error in H5-Editor event listener for ${String(t)}:`,e)}})}removeAllListeners(t){t?this.listeners.delete(t):this.listeners.clear()}}class r{constructor(t){this.emitter=new n,this.currentPage=null,this.pages=new Map,this.options=t,this.containerElement=t.containerElement,this.canvasElement=document.createElement("canvas"),this.containerElement.appendChild(this.canvasElement),this.ctx=this.canvasElement.getContext("2d"),this.setupCanvas(),this.createDefaultPage()}setupCanvas(){const{width:t,height:e}=this.options,i=window.devicePixelRatio||1;this.canvasElement.width=t*i,this.canvasElement.height=e*i,this.canvasElement.style.width=`${t}px`,this.canvasElement.style.height=`${e}px`,this.ctx.scale(i,i)}createDefaultPage(){const t={id:"page_"+Date.now(),name:"页面1",width:this.options.width,height:this.options.height,background:{type:"color",value:"#ffffff"},components:[]};this.pages.set(t.id,t),this.setCurrentPage(t.id)}createPage(t){const e={id:"page_"+Date.now(),name:t,width:this.options.width,height:this.options.height,background:{type:"color",value:"#ffffff"},components:[]};return this.pages.set(e.id,e),e}setCurrentPage(t){const e=this.pages.get(t);e&&(this.currentPage=e,this.render(),this.emitter.emit("pageChange",e))}getCurrentPage(){return this.currentPage}getAllPages(){return Array.from(this.pages.values())}addComponent(t){this.currentPage&&(this.currentPage.components.push(t),this.render(),this.emitter.emit("componentAdd",t))}updateComponent(t,e){if(!this.currentPage)return;const i=this.currentPage.components.find(e=>e.id===t);i&&(Object.assign(i,e),this.render(),this.emitter.emit("componentUpdate",i))}removeComponent(t){if(!this.currentPage)return;const e=this.currentPage.components.findIndex(e=>e.id===t);-1!==e&&(this.currentPage.components.splice(e,1),this.render(),this.emitter.emit("componentRemove",t))}setPageBackground(t){this.currentPage&&(this.currentPage.background=t,this.render())}render(){if(!this.currentPage)return;const{width:t,height:e}=this.options;this.ctx.clearRect(0,0,t,e),this.renderBackground(),this.currentPage.components.forEach(t=>{this.renderComponent(t)})}renderBackground(){if(!this.currentPage)return;const{width:t,height:e}=this.options,{background:i}=this.currentPage;"color"===i.type&&(this.ctx.fillStyle=i.value,this.ctx.fillRect(0,0,t,e))}renderComponent(t){switch(this.ctx.save(),this.ctx.translate(t.x,t.y),t.type){case"text":this.renderTextComponent(t);break;case"image":this.renderImageComponent(t);break;case"button":this.renderButtonComponent(t);break;default:this.ctx.fillStyle="#cccccc",this.ctx.fillRect(0,0,t.width,t.height)}this.ctx.restore()}renderTextComponent(t){const{text:e,fontSize:i,color:n}=t.props;this.ctx.fillStyle=n||"#333333",this.ctx.font=`${i||16}px Arial`,this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.fillText(e||"Text",0,0)}renderImageComponent(t){this.ctx.fillStyle="#f0f0f0",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.strokeStyle="#ccc",this.ctx.strokeRect(0,0,t.width,t.height)}renderButtonComponent(t){const{text:e,backgroundColor:i,textColor:n}=t.props;this.ctx.fillStyle=i||"#007bff",this.ctx.fillRect(0,0,t.width,t.height),this.ctx.fillStyle=n||"#ffffff",this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e||"Button",t.width/2,t.height/2)}exportAsImage(t="png",e=1){return this.canvasElement.toDataURL(`image/${t}`,e)}exportPageData(){return this.currentPage?{...this.currentPage}:null}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}destroy(){this.canvasElement&&this.containerElement.contains(this.canvasElement)&&this.containerElement.removeChild(this.canvasElement)}}var o=i(2675);class s{constructor(){this.type=o.L.H5_EDITOR,this.editor=null,this.container=null}async initialize(t,e){this.container=t,this.editor=new r({containerElement:t,width:e.size.width,height:e.size.height,mode:"mobile"}),await new Promise(t=>setTimeout(t,100))}destroy(){this.editor&&(this.editor.destroy(),this.editor=null),this.container=null}getState(){if(!this.editor)throw new Error("H5 editor not initialized");const t=this.editor.getCurrentPage();return{layers:t?[{id:"default",name:"Default Layer",visible:!0,locked:!1,opacity:1,objects:t.components.map(t=>({id:t.id,type:t.type,position:{x:t.x,y:t.y},size:{width:t.width,height:t.height},rotation:0,opacity:1,visible:!0,locked:!1,zIndex:0}))}]:[],selectedObjects:[],activeLayer:"default",zoom:1,pan:{x:0,y:0}}}setState(t){if(!this.editor)throw new Error("H5 editor not initialized");console.log("Setting H5Editor state:",t)}addObject(t){if(!this.editor)throw new Error("H5 editor not initialized");const e={id:t.id,type:t.type,x:t.position.x,y:t.position.y,width:t.size.width,height:t.size.height,props:{}};this.editor.addComponent(e)}removeObject(t){if(!this.editor)throw new Error("H5 editor not initialized");this.editor.removeComponent(t)}updateObject(t,e){if(!this.editor)throw new Error("H5 editor not initialized");const i={};e.position&&(i.x=e.position.x,i.y=e.position.y),e.size&&(i.width=e.size.width,i.height=e.size.height),this.editor.updateComponent(t,i)}selectObjects(t){if(!this.editor)throw new Error("H5 editor not initialized");console.log("Selecting objects in H5Editor:",t)}clearSelection(){if(!this.editor)throw new Error("H5 editor not initialized");console.log("Clearing selection in H5Editor")}zoom(t){if(!this.editor)throw new Error("H5 editor not initialized");console.log("Zooming H5Editor to:",t)}pan(t,e){if(!this.editor)throw new Error("H5 editor not initialized");console.log("Panning H5Editor to:",t,e)}render(){if(!this.editor)throw new Error("H5 editor not initialized");this.editor.render()}exportImage(t,e=1){if(!this.editor)throw new Error("H5 editor not initialized");return this.editor.exportAsImage(t,e)}getH5Editor(){return this.editor}setPageBackground(t){if(!this.editor)throw new Error("H5 editor not initialized");this.editor.setPageBackground(t)}createPage(t){if(!this.editor)throw new Error("H5 editor not initialized");return this.editor.createPage(t)}setCurrentPage(t){if(!this.editor)throw new Error("H5 editor not initialized");this.editor.setCurrentPage(t)}}}}]);